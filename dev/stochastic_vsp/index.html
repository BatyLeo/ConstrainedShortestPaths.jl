<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic Vehicle Scheduling · ConstrainedShortestPaths.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://BatyLeo.github.io/ConstrainedShortestPaths.jl/stochastic_vsp/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ConstrainedShortestPaths.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../maths/">Mathematical background</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorial</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../basic_shortest_path/">Usual shortest path</a></li><li><a class="tocitem" href="../resource_shortest_path/">Shortest path with linear resource constraints</a></li><li class="is-active"><a class="tocitem" href>Stochastic Vehicle Scheduling</a><ul class="internal"><li><a class="tocitem" href="#Problem-definition"><span>Problem definition</span></a></li><li><a class="tocitem" href="#Column-generation-formulation"><span>Column generation formulation</span></a></li><li><a class="tocitem" href="#Using-ConstrainedShortestPaths"><span>Using ConstrainedShortestPaths</span></a></li><li><a class="tocitem" href="#Column-generation-algorithm"><span>Column generation algorithm</span></a></li></ul></li><li><a class="tocitem" href="../custom/">Implement a custom problem</a></li></ul></li><li><a class="tocitem" href="../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Stochastic Vehicle Scheduling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic Vehicle Scheduling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/BatyLeo/ConstrainedShortestPaths.jl/blob/main/docs/src/literate/stochastic_vsp.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-Vehicle-Scheduling"><a class="docs-heading-anchor" href="#Stochastic-Vehicle-Scheduling">Stochastic Vehicle Scheduling</a><a id="Stochastic-Vehicle-Scheduling-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-Vehicle-Scheduling" title="Permalink"></a></h1><p>This kind application is the main reason this package was created in the first place.</p><h2 id="Problem-definition"><a class="docs-heading-anchor" href="#Problem-definition">Problem definition</a><a id="Problem-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-definition" title="Permalink"></a></h2><p>Vehicle Scheduling involves assigning vehicles to cover a set of scheduled tasks, while minimizing a given objective function.</p><h3 id="Deterministic-version"><a class="docs-heading-anchor" href="#Deterministic-version">Deterministic version</a><a id="Deterministic-version-1"></a><a class="docs-heading-anchor-permalink" href="#Deterministic-version" title="Permalink"></a></h3><p>An instance of the problem is composed of:</p><ul><li>A set of tasks <span>$v\in\bar V$</span>:<ul><li>Scheduled task begin time: <span>$t_v^b$</span></li><li>Scheduled task end time: <span>$t_v^e (&gt; t_v^b)$</span></li><li>Scheduled travel time from task <span>$u$</span> to task <span>$v$</span>: <span>$t_{(u, v)}^{tr}$</span></li></ul></li><li>Task <span>$v$</span> can be scheduled after task <span>$u$</span> on a vehicle path only if: <span>$t_v^b \geq t_u^e + t_{(u, v)}^{tr}$</span></li><li>Objective to minimize: number of vehicle used</li></ul><p>This problem is very easy to solve using a compact MIP formulation.</p><h3 id="Stochastic-version"><a class="docs-heading-anchor" href="#Stochastic-version">Stochastic version</a><a id="Stochastic-version-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-version" title="Permalink"></a></h3><p>The stochastic version is a variation that introduces random delays that occur after the scheduling is fixed. The objective is now to minimize the expectation of the total delay.</p><p>We add the following to instances:</p><ul><li>Finite set of scenarios <span>$\Omega$</span>.</li><li>We indroduce three sets of random variables, which take different values depending on   the scenario <span>$\omega\in\Omega$</span>:<ul><li>Intrisic delay of task <span>$v$</span>: <span>$\varepsilon_v^\omega$</span></li><li>Slack between tasks <span>$u$</span> and <span>$v$</span>: <span>$S_{uv}^\omega$</span></li></ul></li><li>Given an <span>$o-uv$</span> path <span>$P$</span>, we define recursively the delay <span>$\Delta_v^\omega$</span> of task <span>$v$</span> in   scenario <span>$\omega$</span>  along <span>$P$</span>:</li></ul><p class="math-container">\[\boxed{\Delta_v^ω = ε_v^\omega + \max(\Delta_u^\omega - S_{u,v}^\omega, 0)}\]</p><ul><li>Objective to minimize: <span>$\dfrac{1}{|\Omega|}\sum\limits_{\omega\in\Omega} \Delta_v^\omega$</span></li></ul><h2 id="Column-generation-formulation"><a class="docs-heading-anchor" href="#Column-generation-formulation">Column generation formulation</a><a id="Column-generation-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Column-generation-formulation" title="Permalink"></a></h2><p>We model an instance by the following acyclic Digraph <span>$D = (V, A)$</span>:</p><ul><li><span>$V = \bar V\cup \{o, d\}$</span>, with <span>$o$</span> and <span>$d$</span> dummy origin and destination nodes   connected to all tasks:<ul><li><span>$(o, v)$</span> arc for all task <span>$v\in \bar V$</span></li><li><span>$(v, d)$</span> arc for all task <span>$v \in \bar V$</span></li></ul></li><li>There is an arc between tasks <span>$u$</span> and <span>$v$</span> only if <span>$t_v^b \geq t_u^e + t_{(u, v)}^{tr}$</span></li></ul><p>A feasible vehicle tour is an <span>$o-d$</span> path <span>$P\in\mathcal P_{od}$</span>. A feasible solution is a set of disjoint feasible vehicle tours fulfilling all tasks exctly once.</p><p>Cost of a path <span>$P$</span>: <span>$c_P = \dfrac{1}{|\Omega|}\sum\limits_{\omega\in\Omega}\sum\limits_{v\in V\backslash\{o,d\}}\Delta_v^\omega$</span></p><p class="math-container">\[\begin{aligned}
\min &amp; \sum_{P\in\mathcal{P}}c_P y_P &amp;\\
\text{s.t.} &amp; \sum_{p\ni v} y_p = 1 &amp;\forall v\in V\backslash\{o, d\} &amp; \quad(\lambda_v\in\mathbb R)\\
&amp; y_p\in\{0,1\} &amp; \forall p\in \mathcal{P} &amp;
\end{aligned}\]</p><p>This formulation can be solved using a column generation algorithm. The associated subproblem is a constrained shortest path problem of the form :</p><p class="math-container">\[\boxed{\min_{P\in\mathcal P_{od}} \left\{c_P  - \sum_{v\in P}\lambda_v\right\}}\]</p><p>This subproblem can be solved using generalized constrained shortest paths algorithms provided by this package.</p><h2 id="Using-ConstrainedShortestPaths"><a class="docs-heading-anchor" href="#Using-ConstrainedShortestPaths">Using ConstrainedShortestPaths</a><a id="Using-ConstrainedShortestPaths-1"></a><a class="docs-heading-anchor-permalink" href="#Using-ConstrainedShortestPaths" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ConstrainedShortestPaths
using GLPK
using Graphs
using JuMP
using Random
using SparseArrays</code></pre><h3 id="Create-a-random-instance"><a class="docs-heading-anchor" href="#Create-a-random-instance">Create a random instance</a><a id="Create-a-random-instance-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-random-instance" title="Permalink"></a></h3><p>Random graph acyclic directed graph</p><pre><code class="language-julia hljs">function random_acyclic_digraph(nb_vertices::Integer; p=0.4)
    edge_list = []
    for u in 1:nb_vertices
        for v in (u+1):(u == 1 ? nb_vertices-1 : nb_vertices)
            if rand() &lt;= p
                push!(edge_list, (u, v))
            end
        end
    end
    for i in 2:nb_vertices-1
        push!(edge_list, (1, i))
        push!(edge_list, (i, nb_vertices))
    end
    return SimpleDiGraph(Edge.(edge_list))
end

Random.seed!(67)
nb_vertices = 30
nb_scenarios = 10
graph = random_acyclic_digraph(nb_vertices)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">{30, 215} directed simple Int64 graph</code></pre><p>Random delays and slacks matrices:</p><pre><code class="language-julia hljs">nb_edges = ne(graph)
I = [src(e) for e in edges(graph)]
J = [dst(e) for e in edges(graph)]

delays = rand(nb_vertices, nb_scenarios) * 10
delays[end, :] .= 0.0
slacks = [dst(e) == nb_vertices ? [Inf for _ in 1:nb_scenarios] :
    [rand() * 10 for _ in 1:nb_scenarios] for e in edges(graph)]
slack_matrix = sparse(I, J, slacks);

# Path cost computation
function path_cost(path, slacks, delays)
    nb_scenarios = size(delays, 2)
    old_v = path[1]
    R = delays[old_v, :]
    C = 0.0
    for v in path[2:end-1]
        @. R = max(R - slacks[old_v, v], 0) + delays[v, :]
        C += sum(R) / nb_scenarios
        old_v = v
    end
    return C
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">path_cost (generic function with 1 method)</code></pre><h2 id="Column-generation-algorithm"><a class="docs-heading-anchor" href="#Column-generation-algorithm">Column generation algorithm</a><a id="Column-generation-algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Column-generation-algorithm" title="Permalink"></a></h2><p>We use the dual formulation with constraints generation:</p><pre><code class="language-julia hljs">function column_generation(g, slacks, delays)
    nb_vertices = nv(g)
    job_indices = 2:nb_vertices-1

    model = Model(GLPK.Optimizer)

    @variable(model, λ[v in 1:nb_vertices])

    @objective(model, Max, sum(λ[v] for v in job_indices))

    # Initialize constraints set with all [o, v, d] paths
    initial_paths = [[1, v, nb_vertices] for v in 2:nb_vertices-1]
    @constraint(
        model,
        con[p in initial_paths],
        path_cost(p, slacks, delays) - sum(λ[v] for v in job_indices if v in p) &gt;= 0
    )
    @constraint(model, λ[1] == 0)
    @constraint(model, λ[nb_vertices] == 0)

    while true
        # Solve the master problem
        optimize!(model)
        λ_val = value.(λ)
        # Solve the shortest path subproblem
        (; c_star, p_star) = stochastic_routing_shortest_path(
            g, slacks, delays, λ_val
        )
        if c_star &gt; -1e-10
            break
        end
        full_cost = c_star + sum(λ_val[v] for v in job_indices if v in p_star)
        # Add the most violated constraint
        @constraint(
            model,
            full_cost - sum(λ[v] for v in job_indices if v in p_star) &gt;= 0
        )
    end

    return objective_value(model)
end

obj = column_generation(graph, slack_matrix, delays)
@info &quot;Objective value&quot; obj</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Info: Objective value
└   obj = 216.87276861300555</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../resource_shortest_path/">« Shortest path with linear resource constraints</a><a class="docs-footer-nextpage" href="../custom/">Implement a custom problem »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Monday 30 May 2022 15:05">Monday 30 May 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
